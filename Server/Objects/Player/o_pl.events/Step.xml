<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="STEP" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">if !variable_local_exists('cl_is_bot') {host_process_msgs();} else {bot_ai();}

if y &gt; global.map_h &amp;&amp; !dead
{
    //if a player fell
    hp = 0;
    killer_id = 0;
    kill_type = 12;
    plr_send_sound(6, x, y);
}

cd -= 1;
pt -= 1;
ct -= 1;

if hp &lt; 1 &amp;&amp; dead == 0 {plr_die();}
if hp &gt;= 1 &amp;&amp; dead == 1 {dead = 0;}

if position_meeting(x, y - 15, o_water) &amp;&amp; dt &lt; 1800 {dt += 1;}
if !position_meeting(x, y - 15, o_water) &amp;&amp; dt &gt; 0 {dt = 0;}

if dt &gt;= 1800 &amp;&amp; pt &lt; 0 &amp;&amp; !st_inv &amp;&amp; !global.mp_godmode
{
    hp -= 5;
    killer_id = 0;
    kill_type = 9;
    plr_send_stat();
    plr_send_pain();
    pt = 48;
}

if !variable_local_exists('cl_is_bot') {ping += 1;} //in case of timeout we kick player
if ping &gt; global.cl_timeout * global.sv_fps_max
{
    //send a kick message to the fucker just in case
    plr_send_kick(cl_id, "У вас слишком высокий пинг или вы были AFK слишком долго.");
    con_add(":: Клиент " + string(cl_name) + "[" + string(cl_id) + "] кикнут за простой.");
    
    //send this to other clients
    dll39_buffer_clear(0);
    dll39_write_byte(4, 0);
    dll39_write_byte(cl_id, 0);
    with (o_pl) {dll39_message_send(cl_tcp, 0, 0, 0);}
    global.sv_plr[cl_id] = noone;
    instance_destroy();      
}

if dead {exit;}
plr_phys(kb_left, kb_rght, kb_jump);
</argument>
      </arguments>
    </action>
  </actions>
</event>
